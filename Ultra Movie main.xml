<item>
<title>Vodly.us - Trending</title>
<link>$doregex[makelist]</link>
<thumbnail>http://vodly.us/logo.png</thumbnail>
<regex>
<name>makelist</name>
<listrepeat><![CDATA[
        <title>[makelist.param2]</title>
        <link>$doregex[makelist2]</link>
        <thumbnail>[makelist.param3]</thumbnail>
]]></listrepeat>
<expres><![CDATA[#$pyFunction
def GetLSProData(page_data,Cookie_Jar,m,url = ''):
    from resources.lib.modules import client,cache,workers 
    import re

    class page:
        def run(self, r):
            threads = [] ; self.r = [] ; r = [(r.index(i)+1, i) for i in r]
            for i in r: threads.append(workers.Thread(self.request, i))
            [i.start() for i in threads] ; [i.join() for i in threads]
            return ''.join([str(i[1]) for i in sorted(self.r, key=lambda x: x[0])])
        def request(self, i):
            self.r += [(i[0], str(client.request(i[1])))]

    url = []
    for i in range(1, 6): url += ['http://vodly.us/movies/popular?page=' + str(i)]
    u = cache.get(page().run, 0, url)
    u = u.replace('Watch', '')
    u = u.replace(' /', '/')
    e = client.parseDOM(u, 'div', attrs = {'class': 'item-img'})
    e = [(client.parseDOM(i, 'a', ret='href')[0] , client.parseDOM(i, 'a', ret='title')[0] , client.parseDOM(i, 'img', ret='src')[0]) for i in e]
    e = [('http://vodly.us' + i[0], i[1], 'http://vodly.us' + i[2]) for i in e]
    return e
]]></expres>
<page></page>
</regex>
<regex>
<name>makelist2</name>
<listrepeat><![CDATA[
<title>[makelist2.param1]</title>
<link>$doregex[play]</link>
<thumbnail>[makelist.param3]</thumbnail>
]]></listrepeat>
<expres><![CDATA[#$pyFunction
def GetLSProData(page_data,Cookie_Jar,m,url = ''):
    from resources.lib.modules import client
    import re, urllib, xbmc, xbmcgui
    u = client.request('[makelist.param1]')
    e = re.findall('(?s)<tr>.+?<td>([^<]*).+?ef="([^"]*)', u)
    e = [(i[0],'http://vodly.us' + i[1]) for i in e]
    return e
]]></expres>
<page></page>
</regex>
<regex>
<name>play</name>
<expres><![CDATA[#$pyFunction
def GetLSProData(page_data,Cookie_Jar,m,url = ''):
    from resources.lib.modules import client
    import re, urllib, xbmc, xbmcgui
    u = client.request('[makelist2.param2]')
    e = client.parseDOM(u, 'div', attrs = {'class': 'wrap'})
    e = (client.parseDOM(e, 'a', ret='href')[0])
    return e
]]></expres>
<page></page>
</regex>
</item>

<item>
<title>123movieshd - Latest HQ</title>
<link>$doregex[makelist]</link>
<thumbnail>http://phoenixtv.offshorepastebin.com/art/tv/phoenixmovieshdmovies.png</thumbnail>
<regex>
<name>makelist</name>
<listrepeat><![CDATA[
        <title>[makelist.param3] : [makelist.param4]</title>
        <link>$doregex[geturlcosmix]</link>
        <thumbnail>[makelist.param2]</thumbnail>
]]></listrepeat>
<expres><![CDATA[#$pyFunction
def GetLSProData(page_data,Cookie_Jar,m,url = ''):
    from resources.lib.modules import cache,client,workers,control
    import re,urllib,xbmc,xbmcgui,sys   

    if sys.version_info < (2, 7, 9):
        control.infoDialog('[COLOR blue]Please upgrade Kodi 17 or Equivalent[/COLOR]')
        return

    class page:
        def run(self, r):
            threads = [] ; self.r = [] ; r = [(r.index(i)+1, i) for i in r]
            for i in r: threads.append(workers.Thread(self.request, i))
            [i.start() for i in threads] ; [i.join() for i in threads]
            return ''.join([str(i[1]) for i in sorted(self.r, key=lambda x: x[0])])
        def request(self, i):
            self.r += [(i[0], str(client.request(i[1])))]

    url = []
    for i in range(1, 8): url += ['https://123movieshd.tv/movie/filter/movie/hd/all/all/all/latest/?page=' + str(i)]
    html = cache.get(page().run, 0, url)
    link = client.parseDOM(html, 'div', attrs = {'class': 'ml-item'})
    link = [(client.parseDOM(i, 'a', ret='href') , client.parseDOM(i, 'img', ret='data-original') , client.parseDOM(i, 'img', ret='alt') , client.parseDOM(i, 'span', attrs = {'class': 'mli-quality'})) for i in link]
    link = [('https://123movieshd.tv' + i[0][0], 'http:' + i[1][0], i[2][0], i[3][0]) for i in link if i[0] and i[1] and i[2] and i[3]]
    link = [(client.replaceHTMLCodes(i[0]).encode('utf-8'), client.replaceHTMLCodes(i[1]).encode('utf-8'), client.replaceHTMLCodes(i[2]).encode('utf-8'), client.replaceHTMLCodes(i[3]).encode('utf-8')) for i in link]
    return link
]]></expres>
<page></page>
</regex>
<regex>
<name>geturlcosmix</name>
<expres><![CDATA[#$pyFunction
def GetLSProData(page_data,Cookie_Jar,m,url = ''):
    from resources.lib.modules import client,cache,workers 
    import re
    url = '[makelist.param1]' + '/watching.html'
    url = client.request(url)
    e = re.findall('<iframe src="([^"]*)', url)[0]
    url2 = client.request(e)
    e2 = re.findall('file: \'([^\']*)', url2)[0]
    return e2
]]></expres>
<page></page>
</regex>
</item>
